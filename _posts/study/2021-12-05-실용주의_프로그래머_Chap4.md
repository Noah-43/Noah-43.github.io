---
title: 실용주의_프로그래머_Chap4
excerpt: 실용주의 프로그래머 책 4장 정리
categories: study
---

# 4장. 실용주의 편집증

## 21. 계약에 의한 설계

계약은 사람들이 서로 소통하는 것을 돕기 위해 격식적으로나 비격식적으로 전 세계에 걸쳐 사용되는 아이디어다. 소프트웨어 묘듈이 서로 소통하는 것을 돕기 위해 동일하게 개념을 적용할 수 있다. 정확한 프로그램이란, 스스로 자신이 하는 일이라고 주장하는 것 만큼만 일을 하는 프로그램이다. 이 주장을 문서화하고 검증하는 것이 계약에 의한 설계(Design By Contract, DBC)의 핵심이다. DBC는 다음의 내용을 포함한다.

- 선행조건: 루틴이 호출되기 위해 참이어야 하는 것.
- 후행조건: 루틴이 자기가 할 것이라고 보장하는 것.
- 클래스 불변식: 호출자의 입장에서 볼 때, 이 조건이 언제나 참이라는 것을 클래스가 보장.

DBC를 사용하는 최고의 장점은 요구사항과 보증의 문제를 전면으로 내세운다는 것이다. 입력 도메인 범위, 경계 조건, 루틴의 동작 등을 설계 시기에 나열하는 것만으로도 더 나은 소프트웨어 작성에 도움이 된다. DBC는 결국 설계 기법이다. DBC를 지원하지 않는 언어에서 자동 검사가 없더라도 계약을 코드에 주석으로 넣어두고 참고할 수 있다.

문제를 찾고 원인을 밝히기 위해서는, 사고가 났을 때 일찍 멈추는 것이 유리하다. DBC를 사용하면 계약을 지키지 못해 실패했을 때, 에러 메시지와 함께 호출 체인을 보여주는 스택 트레이스가 출력되어 유용하다.



## 22. 죽은 프로그램은 거짓말을 하지 않는다

모든 에러는 정보를 준다. 에러가 발생할 리 없다며 그것을 무시하지 말고, 일찍 작동을 멈추게 하자. 가능한 한 빨리 문제를 발견하게 되면, 좀 더 일찍 시스템을 멈출 수 있다는 이점이 있다. 이는 최선의 선택일 때가 많다. 실행 중인 프로그램을 그냥 종료해 버리는 것은 때로 적절치 못 할 수 있다. 하지만 에러가 발생한 코드를 발견한다면, 프로그램은 더 이상 유효하지 않다고 할 수 있기 때문에 되도록 빨리 종료해야 한다. 일반적으로, 죽은 프로그램이 입히는 피해는 절름발이 프로그램이 끼치는 것보다 훨씬 덜 하다!



## 23. 단정적 프로그래밍

'이런일은 절대 일어날 리 없어'라는 류의 자기기만을 훈련하지 말자, 특히 코딩할때는. 만약 확신한다면 단정문을 사용해서 그것을 확인하는 코드도 만들자. 단정은 알고리즘 동작을 검사하는 데 유용하게 쓰일 수도 있다. 물론, 단정문에 전달된 조건은 부작용이 있으면 안 된다. 또한, 컴파일 중에 단정 기능이 꺼져 있을 수도 있다는 것을 기억하고, 실행되어야만 하는 코드는 절대 assert 속에 두지 말자. 단정은 결코 일어나면 안되는 것들을 검사하는 용도이니 에러처리 대신으로 사용하지 말자.

단정은 코드에 과부하를 주고, 버그에 의해서만 촉발되는 것이니, 빠른 코드 실행을 위해 디버깅 도구일 뿐인 위해 단정을 꺼버려야 한다는 오해가 있다. 여기에는 테스트가 모든 버그를 발견한다는 잘못된 가정이 있고, 외부에서 발생하는 문제를 고려하지 않았다. 문제가 되는 상황을 막기 위한 첫째 방어선은 모든 가능한 에러를 체크하는 것이고, 둘째는 놓친 것들을 잡아내기 위해 단정문을 쓰는 것이다. 퍼포먼스 문제가 있다면, 정말 문제가 되는 단정문만 끄도록 하자.



## 24. 언제 예외를 사용할까

프로그래밍 언어가 예외를 지원한다면 에러 처리르 한 장소에 옮겨 코드를 깨끗하게 작성할 수 있다. 예외문을 사용할 때는 그것이 예외를 던지는 상황이 맞는지 판단해야 한다. 예외는 예외적인 문제에만 사용하자. 그렇지 않고 예외를 정상적인 처리 과정의 일부로 사용하면 가독성 문제와 관리성 문제가 발생하고, 캡슐화를 깨트린다. 에러처리기는 에러가 감지되었을 때 호출되는 루틴으로, 예외를 지원하지 않은 언어 뿐만 아니라 예외 처리 기능이 들어가 있는 언어에서도 사용할 수 있다.



## 25. 리소스 사용의 균형

코딩할 때 우리는 메모리, 트랜잭션, 쓰레드, 파일, 타이머 등의 리소스를 관리한다. 기본적으로 리소스를 할당하는 루틴이 해제 역시 책임져야한다. 그리고 리소스를 할당한 순서의 반대로 해제하고, 코드의 여러 곳에서 동일한 리소스 집합을 할당하는 경우에는 할당 순서를 언제나 같도록 하자. 클래스의 생성자와 소멸자가 존재하는 덕분에, 리소스를 클래스 안에 캡슐화 했을 때 예외와 같은 상황이 발생해도 리소스 해제에 도움을 받을 수 있다. 자바에서는 finally절을 사용할 수 있다. 정말로 리소스가 적절하게 해제되었는지 실제로 점검하는 코드를 늘 작성하는 것이 좋다!
